<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מערכת ניטור איכות האוויר בישראל</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="app.js"></script>
    <script src="accessibility.js"></script>
    <script src="shared.js"></script>
    <link rel="stylesheet" href="style.css">


    <style>
:root {
    --primary-color: #1a5f7a;
    --secondary-color: #159895;
    --accent-color: #ff6b6b;
    --background-color: #f0f8ff;
    --text-color: #333;
    --card-background: #ffffff;
    --shadow-color: rgba(0, 0, 0, 0.1);
}

body {
    font-family: 'Heebo', sans-serif;
    background-color: var(--background-color);
    color: var(--text-color);
    line-height: 1.6;
    margin: 0;
    padding: 0;
    transition: background-color 0.3s, color 0.3s;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

header {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white;
    text-align: center;
    padding: 30px 0;
    box-shadow: 0 4px 6px var(--shadow-color);
    position: relative;
    overflow: hidden;
}

h1 {
    margin: 0 0 15px 0;
    font-size: 2.2em;
}

.search-container {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 0 auto;
    max-width: 300px;
    position: relative;
}

#citySearch {
    width: 100%;
    padding: 10px 40px 10px 15px;
    font-size: 0.9em;
    border: none;
    border-radius: 20px;
    box-shadow: 0 2px 5px var(--shadow-color);
    transition: all 0.3s ease;
}

#citySearch:focus {
    outline: none;
    box-shadow: 0 4px 8px var(--shadow-color);
}

.search-icon {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--primary-color);
    font-size: 0.9em;
    pointer-events: none;
}

.search-results {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background-color: var(--card-background);
    border-radius: 0 0 15px 15px;
    box-shadow: 0 4px 8px var(--shadow-color);
    z-index: 1000;
    max-height: 200px;
    overflow-y: auto;
}

.search-result-item {
    padding: 10px 15px;
    cursor: pointer;
    transition: background-color 0.3s;
    font-size: 0.9em;
}

.search-result-item:hover {
    background-color: rgba(0, 0, 0, 0.05);
}

.city-container {
    background-color: var(--card-background);
    border-radius: 15px;
    box-shadow: 0 10px 20px var(--shadow-color);
    padding: 30px;
    margin-bottom: 30px;
    transition: transform 0.3s;
}

.city-container:hover {
    transform: translateY(-5px);
}

.aqi-indicator {
    display: inline-block;
    padding: 8px 15px;
    border-radius: 20px;
    color: white;
    font-weight: bold;
    margin-right: 15px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}

.pollutant-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 25px;
    margin-top: 30px;
}

.pollutant-item {
    background-color: var(--card-background);
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    transition: all 0.3s;
    cursor: pointer;
    box-shadow: 0 4px 6px var(--shadow-color);
}

.pollutant-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 15px var(--shadow-color);
}

.pollutant-item i {
    font-size: 2.5em;
    color: var(--secondary-color);
    margin-bottom: 15px;
}

.chart-container {
    margin-top: 40px;
    padding: 20px;
    background-color: var(--card-background);
    border-radius: 15px;
    box-shadow: 0 5px 15px var(--shadow-color);
}

.explanation, .health-advice {
    background-color: var(--card-background);
    border-radius: 12px;
    padding: 25px;
    margin-top: 30px;
    box-shadow: 0 5px 15px var(--shadow-color);
}

.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.6);
}

.modal-content {
    background-color: var(--card-background);
    margin: 10% auto;
    padding: 30px;
    border: 1px solid #888;
    width: 80%;
    max-width: 600px;
    border-radius: 15px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
}

.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    transition: color 0.3s;
}

.close:hover,
.close:focus {
    color: var(--accent-color);
    text-decoration: none;
    cursor: pointer;
}

.scroll-to-top, .dark-mode-toggle {
    position: fixed;
    bottom: 30px;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background-color: var(--primary-color);
    color: white;
    text-align: center;
    line-height: 50px;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
}

.scroll-to-top {
    right: 30px;
}

.dark-mode-toggle {
    right: 90px;
}

.scroll-to-top:hover, .dark-mode-toggle:hover {
    background-color: var(--secondary-color);
    transform: translateY(-5px);
}

/* Dark mode styles */
body.dark-mode {
    --background-color: #1a1a2e;
    --text-color: #e0e0e0;
    --card-background: #16213e;
    --shadow-color: rgba(255, 255, 255, 0.1);
}

body.dark-mode .search-results,
body.dark-mode .city-container,
body.dark-mode .pollutant-item,
body.dark-mode .chart-container,
body.dark-mode .explanation,
body.dark-mode .health-advice,
body.dark-mode .modal-content {
    background-color: var(--card-background);
    color: var(--text-color);
}

body.dark-mode #citySearch {
    background-color: #2a2a3e;
    color: var(--text-color);
}

body.dark-mode .search-result-item:hover {
    background-color: rgba(255, 255, 255, 0.1);
}

/* Responsive design */
@media (max-width: 768px) {
    .pollutant-grid {
        grid-template-columns: 1fr 1fr;
    }

    .search-container {
        max-width: 250px;
    }

    #citySearch {
        font-size: 0.8em;
    }
}

@media (max-width: 480px) {
    .pollutant-grid {
        grid-template-columns: 1fr;
    }

    h1 {
        font-size: 1.8em;
    }

    .search-container {
        max-width: 200px;
    }
}
.search-icon {
    position: absolute;
    right: 225px;  /* שינינו מ-15px ל-20px */
    top: 50%;
    transform: translateY(-50%);
    color: var(--primary-color);
    font-size: 0.9em;
    pointer-events: none;
}
   </style>
</head>
<body>
<div id="navbar-placeholder"></div>

    <button id="scrollToTopBtn" class="scroll-to-top" aria-label="גלול למעלה">
        <i class="fas fa-chevron-up" aria-hidden="true"></i>
    </button>

    <button id="darkModeToggle" class="dark-mode-toggle" aria-label="החלף למצב לילה">
        <i class="fas fa-moon" aria-hidden="true"></i>
    </button>
    <header>
        <h1>מערכת ניטור איכות האוויר בישראל</h1>
    </header>
    <div class="container">
        <div class="search-container">
            <input type="text" id="citySearch" placeholder="חפש עיר...">
            <i class="fas fa-search search-icon"></i>
            <div id="searchResults" class="search-results"></div>
        </div>
        <div id="cityData"></div>
        <p class="last-updated" id="lastUpdated"></p>
    </div>

    <div id="pollutantModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modalTitle"></h2>
            <p id="modalDescription"></p>
        </div>
    </div>

<script>




        // Initialize accessibility features
        document.addEventListener('DOMContentLoaded', (event) => {
            if (typeof initializeAccessibility === 'function') {
                initializeAccessibility();
            }
        });


         function initializeSearch() {
            const searchInput = document.getElementById('citySearch');
            const searchResults = document.getElementById('searchResults');

            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const matchedCities = citiesData.filter(city =>
                    city.city.toLowerCase().includes(searchTerm)
                );

                displaySearchResults(matchedCities);
            });

            searchInput.addEventListener('focus', function() {
                if (this.value) {
                    searchResults.style.display = 'block';
                }
            });

            document.addEventListener('click', function(e) {
                if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
                    searchResults.style.display = 'none';
                }
            });
        }

        function displaySearchResults(cities) {
            const searchResults = document.getElementById('searchResults');
            searchResults.innerHTML = '';

            if (cities.length > 0) {
                cities.forEach(city => {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'search-result-item';
                    resultItem.innerHTML = `<i class="fas fa-city"></i>${city.city}`;
                    resultItem.addEventListener('click', function() {
                        document.getElementById('citySearch').value = city.city;
                        displayCityData(city);
                        searchResults.style.display = 'none';
                    });
                    searchResults.appendChild(resultItem);
                });
                searchResults.style.display = 'block';
            } else {
                searchResults.style.display = 'none';
            }
        }

        fetch('weather_data.json')
            .then(response => response.json())
            .then(data => {
                citiesData = data.cities;
                initializeSearch();
                const jerusalemData = citiesData.find(city => city.city === 'ירושלים');
                if (jerusalemData) {
                    displayCityData(jerusalemData);
                }
                updateLastUpdated(data.last_updated);
            })
            .catch(error => console.error('Error:', error));

        let citiesData = {};

        function getAQIColor(aqi) {
            const colors = ['#00e400', '#ffff00', '#ff7e00', '#ff0000', '#8f3f97', '#7e0023'];
            return colors[aqi - 1] || colors[colors.length - 1];
        }

        function getAQIDescription(aqi) {
            const descriptions = [
                'טובה',
                'בינונית',
                'לא בריאה לקבוצות רגישות',
                'לא בריאה',
                'מאוד לא בריאה',
                'מסוכנת'
            ];
            return descriptions[aqi - 1] || 'לא ידוע';
        }

        function createPollutantChart(cityName, pollutantData) {
            const ctx = document.getElementById(`${cityName}-pollutant-chart`).getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(pollutantData).map(key => getPollutantName(key)),
                    datasets: [{
                        label: 'ריכוז (µg/m³)',
                        data: Object.values(pollutantData),
                        backgroundColor: 'rgba(26, 95, 122, 0.6)',
                        borderColor: 'rgba(26, 95, 122, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'ריכוז (µg/m³)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function createAQIForecastChart(cityName, forecastData) {
            const ctx = document.getElementById(`${cityName}-aqi-forecast-chart`).getContext('2d');
            const labels = forecastData.map(item => moment.unix(item.dt).format('HH:mm'));
            const aqiData = forecastData.map(item => item.main.aqi);

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'מדד איכות אוויר',
                        data: aqiData,
                        borderColor: 'rgb(26, 95, 122)',
                        backgroundColor: 'rgba(26, 95, 122, 0.1)',
                        tension: 0.1,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 5,
                            title: {
                                display: true,
                                text: 'מדד איכות אוויר'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'שעה'
                            }
                        }
                    }
                }
            });
        }

        function displayCityData(city) {
            const cityDataContainer = document.getElementById('cityData');
            const aqi = city.current.air_pollution.main.aqi;
            const aqiColor = getAQIColor(aqi);
            const aqiDescription = getAQIDescription(aqi);

            const cityElement = document.createElement('div');
            cityElement.id = `${city.city}-container`;
            cityElement.className = 'city-container';

            cityElement.innerHTML = `
                <h2>${city.city}</h2>
                <div>
                    <span class="aqi-indicator" style="background-color: ${aqiColor};">
                        מדד איכות אוויר: ${aqi}
                    </span>
                    <span>${aqiDescription}</span>
                </div>
                <div class="pollutant-grid">
                    ${Object.entries(city.current.air_pollution.components).map(([key, value]) => `
                        <div class="pollutant-item" onclick="showPollutantInfo('${key}')">
                            <i class="icon fas ${getPollutantIcon(key)}"></i>
                            <h3>${getPollutantName(key)}</h3>
                            <p>${value.toFixed(2)} µg/m³</p>
                            <small>לחץ למידע נוסף</small>
                        </div>
                    `).join('')}
                </div>
                <div class="chart-container">
                    <h3>ריכוז מזהמים</h3>
                    <canvas id="${city.city}-pollutant-chart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>תחזית איכות אוויר</h3>
                    <canvas id="${city.city}-aqi-forecast-chart"></canvas>
                </div>
                <div class="explanation">
                    <h3>הסבר על איכות האוויר ב${city.city}</h3>
                    <p>מדד איכות האוויר הנוכחי ב${city.city} הוא ${aqi}, המוגדר כ${aqiDescription}.
                    זה מבוסס על ריכוזי מזהמים שונים באוויר, כולל חלקיקים עדינים (PM2.5 ו-PM10),
                    אוזון (O3), חנקן דו-חמצני (NO2), גופרית דו-חמצנית (SO2) ופחמן חד-חמצני (CO).</p>
                    <p>חשוב לשים לב לשינויים באיכות האוויר לאורך היום ולנקוט באמצעי זהירות בהתאם,
                    במיוחד עבור אוכלוסיות רגישות כמו ילדים, קשישים ואנשים עם בעיות נשימה.</p>
                </div>
                <div class="health-advice">
                    <h3>המלצות בריאותיות</h3>
                    <p>${getHealthAdvice(aqi)}</p>
                </div>
            `;

            cityDataContainer.innerHTML = '';
            cityDataContainer.appendChild(cityElement);
            createPollutantChart(city.city, city.current.air_pollution.components);
            createAQIForecastChart(city.city, city.forecast.air_pollution);
        }

        function getPollutantName(key) {
            const names = {
                'co': 'פחמן חד-חמצני',
                'no': 'חנקן חד-חמצני',
                'no2': 'חנקן דו-חמצני',
                'o3': 'אוזון',
                'so2': 'גופרית דו-חמצנית',
                'pm2_5': 'חלקיקים עדינים (PM2.5)',
                'pm10': 'חלקיקים גסים (PM10)',
                'nh3': 'אמוניה'
            };
            return names[key] || key;
        }

        function getPollutantIcon(key) {
            const icons = {
                'co': 'fa-smog',
                'no': 'fa-cloud',
                'no2': 'fa-cloud',
                'o3': 'fa-sun',
                'so2': 'fa-industry',
                'pm2_5': 'fa-dust',
                'pm10': 'fa-dust',
                'nh3': 'fa-flask'
            };
                       return icons[key] || 'fa-question-circle';
        }

        function getHealthAdvice(aqi) {
            const advice = [
                'איכות האוויר טובה. זה הזמן המושלם לפעילויות בחוץ.',
                'איכות האוויר סבירה. אנשים רגישים במיוחד צריכים לשקול להגביל חשיפה ממושכת.',
                'איכות האוויר לא בריאה לקבוצות רגישות. יש להגביל פעילות מאומצת בחוץ.',
                'איכות האוויר לא בריאה. יש להימנע מפעילות ממושכת בחוץ.',
                'איכות האוויר מאוד לא בריאה. יש להימנע מכל פעילות בחוץ.',
                'איכות האוויר מסוכנת. יש להישאר בבית ולסגור חלונות.'
            ];
            return advice[aqi - 1] || 'יש להתעדכן בהנחיות הרשויות המקומיות.';
        }

        function getPollutantDescription(key) {
            const descriptions = {
                'co': 'פחמן חד-חמצני הוא גז רעיל חסר צבע וריח. הוא נוצר בעיקר משריפה לא מלאה של דלקים. חשיפה ממושכת עלולה לגרום לבעיות בריאותיות חמורות.',
                'no': 'חנקן חד-חמצני הוא גז חסר צבע וריח. הוא נוצר בעיקר משריפת דלקים במנועי רכב. הוא יכול להפוך לחנקן דו-חמצני באוויר.',
                'no2': 'חנקן דו-חמצני הוא גז חום-אדמדם בעל ריח חריף. הוא נוצר משריפת דלקים ותורם ליצירת ערפיח. חשיפה עלולה לגרום לבעיות נשימה.',
                'o3': 'אוזון הוא גז חסר צבע עם ריח חריף. ברמות הקרקע הוא מזהם מסוכן הנוצר מתגובות כימיות בין תחמוצות חנקן ותרכובות אורגניות נדיפות. הוא יכול לגרום לבעיות נשימה ונזק לריאות.',
                'so2': 'גופרית דו-חמצנית היא גז חסר צבע עם ריח חריף. היא נוצרת בעיקר משריפת דלקים המכילים גופרית. חשיפה עלולה לגרום לגירוי בדרכי הנשימה ולהחמיר מחלות נשימה קיימות.',
                'pm2_5': 'חלקיקים עדינים (PM2.5) הם חלקיקים זעירים באוויר בקוטר של 2.5 מיקרומטר או פחות. הם יכולים לחדור עמוק לריאות ואף למחזור הדם, ועלולים לגרום לבעיות בריאותיות חמורות.',
                'pm10': 'חלקיקים גסים (PM10) הם חלקיקים באוויר בקוטר של 10 מיקרומטר או פחות. הם יכולים לחדור לדרכי הנשימה העליונות ולגרום לבעיות נשימה ואלרגיות.',
                'nh3': 'אמוניה היא גז חסר צבע בעל ריח חריף. היא נפלטת בעיקר מפעילות חקלאית ותעשייתית. חשיפה לריכוזים גבוהים עלולה לגרום לגירוי בעיניים ובדרכי הנשימה.'
            };
            return descriptions[key] || 'אין מידע זמין על מזהם זה.';
        }

        function showPollutantInfo(key) {
            const modal = document.getElementById('pollutantModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalDescription = document.getElementById('modalDescription');

            modalTitle.textContent = getPollutantName(key);
            modalDescription.textContent = getPollutantDescription(key);
            modal.style.display = 'block';
        }

        function initializeSearch() {
            const searchInput = document.getElementById('citySearch');
            const datalist = document.createElement('datalist');
            datalist.id = 'cityList';
            document.body.appendChild(datalist);
            searchInput.setAttribute('list', 'cityList');

            citiesData.forEach(city => {
                const option = document.createElement('option');
                option.value = city.city;
                datalist.appendChild(option);
            });

            searchInput.addEventListener('input', function() {
                const selectedCity = citiesData.find(city => city.city === this.value);
                if (selectedCity) {
                    displayCityData(selectedCity);
                }
            });
        }

        fetch('weather_data.json')
            .then(response => response.json())
            .then(data => {
                citiesData = data.cities;
                initializeSearch();
                displayCityData(citiesData.find(city => city.city === 'ירושלים'));
                updateLastUpdated(data.last_updated);
            })
            .catch(error => console.error('Error:', error));

        function updateLastUpdated(lastUpdated) {
            const lastUpdatedElement = document.getElementById('lastUpdated');
            const date = new Date(lastUpdated);
            lastUpdatedElement.textContent = `עודכן לאחרונה: ${date.toLocaleString('he-IL')}`;
        }

        // Close modal when clicking on the close button or outside the modal
        window.onclick = function(event) {
            const modal = document.getElementById('pollutantModal');
            if (event.target == modal || event.target.className == 'close') {
                modal.style.display = 'none';
            }
        }



        function initializeSearch() {
            const searchInput = document.getElementById('citySearch');
            const searchResults = document.getElementById('searchResults');

            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const matchedCities = citiesData.filter(city =>
                    city.city.toLowerCase().includes(searchTerm)
                );

                displaySearchResults(matchedCities);
            });

            searchInput.addEventListener('focus', function() {
                if (this.value) {
                    searchResults.style.display = 'block';
                }
            });

            document.addEventListener('click', function(e) {
                if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
                    searchResults.style.display = 'none';
                }
            });
        }

        function displaySearchResults(cities) {
            const searchResults = document.getElementById('searchResults');
            searchResults.innerHTML = '';

            if (cities.length > 0) {
                cities.forEach(city => {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'search-result-item';
                    resultItem.innerHTML = `<i class="fas fa-city"></i>${city.city}`;
                    resultItem.addEventListener('click', function() {
                        document.getElementById('citySearch').value = city.city;
                        displayCityData(city);
                        searchResults.style.display = 'none';
                    });
                    searchResults.appendChild(resultItem);
                });
                searchResults.style.display = 'block';
            } else {
                searchResults.style.display = 'none';
            }
        }


</script>
</body>
</html>